#!/bin/bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SERVER-BAUKASTEN KONFIGURATIONSDATEI
# Version: 1.2 (mit Secrets-Support & config_helper.sh KompatibilitÃ¤t)
# 
# Verwendung: sudo ./serverbaukasten.sh -c /pfad/zu/dieser/datei.conf
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KERN-KONFIGURATION (immer erforderlich)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Server-IdentitÃ¤t
SERVER_HOSTNAME="my-secure-server"
ADMIN_USER="admin"

# ğŸ”’ PASSWÃ–RTER - WICHTIGER SICHERHEITSHINWEIS:
# Option 1: Klartext (UNSICHER fÃ¼r Produktion)
ADMIN_PASSWORD="CHANGE-THIS-PASSWORD-123"
ROOT_PASSWORD="CHANGE-THIS-ROOT-PASSWORD-456"

# Option 2: Secrets aus Dateien (EMPFOHLEN fÃ¼r Produktion)
# ADMIN_PASSWORD_FILE="/run/secrets/admin_password"
# ROOT_PASSWORD_FILE="/run/secrets/root_password"
# 
# Dateien erstellen mit:
# echo "dein-sicheres-passwort" | sudo tee /run/secrets/admin_password
# sudo chmod 600 /run/secrets/admin_password

# Benachrichtigungen
NOTIFICATION_EMAIL="admin@example.com"

# Netzwerk & Zugang
ACCESS_MODEL="1"          # 1=VPN (Tailscale), 2=Ã–ffentlich
SSH_PORT="2222"           # Port >1024 fÃ¼r bessere Sicherheit

# Lokalisierung (wichtig fÃ¼r GeoIP-Heimatland-Erkennung!)
TIMEZONE="Europe/Berlin"
LOCALE="de_DE.UTF-8"     # de_DE â†’ Deutschland, en_US â†’ USA, fr_FR â†’ Frankreich

# Server-Typ
SERVER_ROLE="1"          # 1=Docker-Host, 2=Einfacher Server

# Updates
UPGRADE_EXTENDED="ja"    # ja=Security+Updates, nein=nur Security

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SICHERHEITSKONFIGURATION (CrowdSec)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CROWDSEC_MAXRETRY="5"     # Anzahl SSH-Fehlversuche bis Ban
CROWDSEC_BANTIME="48h"    # Sperrdauer (z.B. 12h, 24h, 48h, 7d)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GEOIP-BLOCKING KONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ENABLE_GEOIP_BLOCKING="ja"  # ja=aktiviert, nein=deaktiviert

# Heimatland (wird NIE blockiert, automatisch geschÃ¼tzt)
# Wird normalerweise aus LOCALE abgeleitet, kann aber Ã¼berschrieben werden
HOME_COUNTRY="DE"           # 2-stelliger ISO-Code: DE, US, FR, AT, CH, etc.

# Blockierte LÃ¤nder (Leerzeichen-getrennte 2-stellige ISO-Codes)
# HÃ¤ufige Presets:
# Standard:  "CN RU KP IR"                    # ~70% Angriffs-Reduktion
# Maximal:   "CN RU KP IR BY MM SY AF IQ LY"  # ~85% Angriffs-Reduktion  
# Minimal:   "CN RU"                          # ~60% Angriffs-Reduktion
BLOCKED_COUNTRIES="CN RU KP IR"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DOCKER-KONFIGURATION (nur wenn SERVER_ROLE="1")
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DOCKER_IPV4_CIDR="172.20.0.0/16"      # Docker IPv4-Netzwerk
DOCKER_IPV6_CIDR="fd00:cafe:beef::/56" # Docker IPv6-Netzwerk

INSTALL_PORTAINER="ja"     # ja=installieren, nein=Ã¼berspringen
INSTALL_WATCHTOWER="ja"    # ja=installieren, nein=Ã¼berspringen

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# E-MAIL-KONFIGURATION (optional aber empfohlen)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ENABLE_SYSTEM_MAIL="ja"    # ja=E-Mail-Benachrichtigungen aktivieren

# SMTP-Server-Einstellungen
SMTP_HOST="smtp.example.com"
SMTP_PORT="587"                         # Standard STARTTLS-Port
SMTP_FROM="server@example.com"

# SMTP-Sicherheit
SMTP_AUTH="ja"            # ja=Authentifizierung erforderlich
SMTP_TLS_STARTTLS="ja"    # ja=STARTTLS verwenden (empfohlen)

# SMTP-Credentials (nur wenn SMTP_AUTH="ja")
# ğŸ”’ SMTP PASSWORT - SICHERHEITSOPTIONEN:
# Option 1: Klartext (fÃ¼r Tests ok)
SMTP_USER="your-smtp-username"
SMTP_PASSWORD="your-smtp-password"

# Option 2: Passwort aus Datei (EMPFOHLEN fÃ¼r Produktion)
# SMTP_PASSWORD_FILE="/run/secrets/smtp_password"
# 
# Datei erstellen mit:
# echo "dein-smtp-passwort" | sudo tee /run/secrets/smtp_password
# sudo chmod 600 /run/secrets/smtp_password

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# OPTIONALE KONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# SSH Public Key (optional, erhÃ¶ht Sicherheit erheblich)
# SSH_PUBLIC_KEY="ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIExample... user@hostname"

# Tailscale Autorisierung (optional, fÃ¼r automatisches VPN-Setup)
# ğŸ”’ TAILSCALE AUTH KEY - SICHERHEITSOPTIONEN:
# Option 1: Klartext
# TAILSCALE_AUTH_KEY="tskey-auth-example123..."

# Option 2: Key aus Datei (EMPFOHLEN)
# TAILSCALE_AUTH_KEY_FILE="/run/secrets/tailscale_authkey"

# Portainer IP (optional, wird sonst automatisch gewÃ¤hlt)
# PORTAINER_IP="127.0.0.1"  # Lokal, 0.0.0.0=Ã¶ffentlich, Tailscale-IP=VPN

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SECRETS MANAGEMENT - BEST PRACTICES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ğŸ”’ FÃ¼r Produktionssysteme wird empfohlen, alle PasswÃ¶rter Ã¼ber *_FILE zu laden:
#
# 1. Secrets-Ordner erstellen:
#    sudo mkdir -p /run/secrets
#    sudo chmod 700 /run/secrets
#
# 2. Password-Dateien erstellen:
#    echo "admin-password-hier" | sudo tee /run/secrets/admin_password
#    echo "root-password-hier"  | sudo tee /run/secrets/root_password  
#    echo "smtp-password-hier"  | sudo tee /run/secrets/smtp_password
#    echo "tailscale-key-hier"  | sudo tee /run/secrets/tailscale_authkey
#
# 3. Dateiberechtigungen setzen:
#    sudo chmod 600 /run/secrets/*
#    sudo chown root:root /run/secrets/*
#
# 4. In dieser Config die *_FILE Variablen aktivieren (Zeilen uncommentieren)
#
# 5. Klartext-PasswÃ¶rter entfernen oder auskommentieren
#
# VORTEILE:
# - PasswÃ¶rter nicht im Klartext in Config-Datei
# - Bessere Sicherheit bei Backups/Versionskontrolle
# - Secrets kÃ¶nnen separat verwaltet werden
# - Log-Maskierung verhindert versehentliche Passwort-Ausgabe

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KONFIGURATIONSBEISPIELE FÃœR VERSCHIEDENE SZENARIEN
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ SZENARIO 1: Deutscher VPS mit maximaler Sicherheit + Secrets           â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# ACCESS_MODEL="1"                    # Nur Tailscale-Zugang
# SSH_PORT="2222"                     # Nicht-Standard-Port
# LOCALE="de_DE.UTF-8"               # Deutsche Locale
# HOME_COUNTRY="DE"                  # Deutschland geschÃ¼tzt
# BLOCKED_COUNTRIES="CN RU KP IR BY MM SY AF IQ LY"  # Maximal-Blocking
# ENABLE_GEOIP_BLOCKING="ja"
# ENABLE_SYSTEM_MAIL="ja"
# ADMIN_PASSWORD_FILE="/run/secrets/admin_password"
# ROOT_PASSWORD_FILE="/run/secrets/root_password"
# SMTP_PASSWORD_FILE="/run/secrets/smtp_password"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ SZENARIO 2: Ã–ffentlicher US-Server mit Standard-Schutz                 â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# ACCESS_MODEL="2"                    # Ã–ffentlich erreichbar
# SSH_PORT="2222"                     # Sicherer SSH-Port
# LOCALE="en_US.UTF-8"               # US-Locale
# HOME_COUNTRY="US"                  # USA geschÃ¼tzt
# BLOCKED_COUNTRIES="CN RU KP IR"    # Standard-Blocking
# ENABLE_GEOIP_BLOCKING="ja"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ SZENARIO 3: Schweizer Server ohne GeoIP (minimaler Ansatz)             â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# ACCESS_MODEL="1"                    # Tailscale
# SSH_PORT="2222"                     # Sicherer Port
# LOCALE="de_CH.UTF-8"               # Schweizer Locale
# ENABLE_GEOIP_BLOCKING="nein"       # Kein GeoIP-Blocking
# ENABLE_SYSTEM_MAIL="nein"         # Keine E-Mails

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HÃ„UFIGE LÃ„NDER-CODES FÃœR GEOIP-KONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# EuropÃ¤ische LÃ¤nder:
# DE=Deutschland, AT=Ã–sterreich, CH=Schweiz, FR=Frankreich, IT=Italien
# ES=Spanien, NL=Niederlande, BE=Belgien, SE=Schweden, NO=Norwegen
# DK=DÃ¤nemark, FI=Finnland, PL=Polen, CZ=Tschechien, GB=GroÃŸbritannien

# Weitere wichtige LÃ¤nder:
# US=USA, CA=Kanada, AU=Australien, JP=Japan, SG=Singapur, KR=SÃ¼dkorea

# HÃ¤ufige Bedrohungsquellen (fÃ¼r Blocklist):
# CN=China, RU=Russland, KP=Nordkorea, IR=Iran, BY=Belarus
# MM=Myanmar, SY=Syrien, AF=Afghanistan, IQ=Irak, LY=Libyen
# PK=Pakistan, BD=Bangladesch, VN=Vietnam, IN=Indien (mit Vorsicht)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WICHTIGE HINWEISE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ğŸ”’ SICHERHEIT:
# - SSH_PORT auf >1024 fÃ¼r bessere Sicherheit (z.B. 2222)
# - Verwende *_FILE fÃ¼r alle PasswÃ¶rter in Produktionsumgebung
# - SSH Public Key ist STARK empfohlen
# - Tailscale (ACCESS_MODEL="1") bietet beste Sicherheit

# ğŸŒ GEOIP-BLOCKING:
# - HOME_COUNTRY wird NIEMALS blockiert (automatischer Schutz)
# - LÃ¶st Konflikte automatisch (entfernt HOME_COUNTRY aus BLOCKED_COUNTRIES)
# - Lokale Netze (192.168.x.x) werden immer erlaubt
# - Reduziert Angriffe um 60-85% je nach Konfiguration

# ğŸ“§ E-MAIL-BENACHRICHTIGUNGEN:
# - Gmail: App-Passwort verwenden (nicht normales Passwort)
# - Outlook: smtp-mail.outlook.com:587
# - SMTP_PASSWORD_FILE fÃ¼r bessere Sicherheit verwenden

# ğŸ³ DOCKER:
# - Nur bei SERVER_ROLE="1" erforderlich
# - IPv4/IPv6 CIDRs dÃ¼rfen nicht mit vorhandenen Netzen kollidieren
# - Portainer: 127.0.0.1 (sicherster Zugang), 0.0.0.0 (Ã¶ffentlich)

# ğŸ” SECRETS:
# - *_FILE Variablen haben Vorrang vor Klartext-Variablen
# - Secrets werden automatisch aus /run/secrets/ geladen
# - Log-Maskierung verhindert versehentliche Passwort-Ausgabe in Logs

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ENDE DER KONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•