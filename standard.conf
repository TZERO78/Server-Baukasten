#!/bin/bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SERVER-BAUKASTEN KONFIGURATIONSDATEI
# Version: 1.1 (mit GeoIP-Heimatland-Support)
# 
# Verwendung: sudo ./init_server.sh -c /pfad/zu/dieser/datei.conf
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KERN-KONFIGURATION (immer erforderlich)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Server-IdentitÃ¤t
SERVER_HOSTNAME="my-secure-server"
ADMIN_USER="admin"
ADMIN_PASSWORD="CHANGE-THIS-PASSWORD-123"
ROOT_PASSWORD="CHANGE-THIS-ROOT-PASSWORD-456"

# Benachrichtigungen
NOTIFICATION_EMAIL="admin@example.com"

# Netzwerk & Zugang
ACCESS_MODEL="1"          # 1=VPN (Tailscale), 2=Ã–ffentlich
SSH_PORT="22"

# Lokalisierung (wichtig fÃ¼r GeoIP-Heimatland-Erkennung!)
TIMEZONE="Europe/Berlin"
LOCALE="de_DE.UTF-8"     # de_DE â†’ Deutschland, en_US â†’ USA, fr_FR â†’ Frankreich

# Server-Typ
SERVER_ROLE="1"          # 1=Docker-Host, 2=Einfacher Server

# Updates
UPGRADE_EXTENDED="ja"  # ja=Security+Updates, nein=nur Security

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SICHERHEITSKONFIGURATION (CrowdSec)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CROWDSEC_MAXRETRY="5"     # Anzahl SSH-Fehlversuche bis Ban
CROWDSEC_BANTIME="48h"    # Sperrdauer (z.B. 12h, 24h, 48h, 7d)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GEOIP-BLOCKING KONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ENABLE_GEOIP_BLOCKING="ja"  # ja=aktiviert, nein=deaktiviert

# Heimatland (wird NIE blockiert, automatisch geschÃ¼tzt)
# Wird normalerweise aus LOCALE abgeleitet, kann aber Ã¼berschrieben werden
HOME_COUNTRY="DE"           # 2-stelliger ISO-Code: DE, US, FR, AT, CH, etc.

# Blockierte LÃ¤nder (Leerzeichen-getrennte 2-stellige ISO-Codes)
# HÃ¤ufige Presets:
# Standard:  "CN RU KP IR"                    # ~70% Angriffs-Reduktion
# Maximal:   "CN RU KP IR BY MM SY AF IQ LY"  # ~85% Angriffs-Reduktion  
# Minimal:   "CN RU"                          # ~60% Angriffs-Reduktion
BLOCKED_COUNTRIES="CN RU KP IR"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DOCKER-KONFIGURATION (nur wenn SERVER_ROLE="1")
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DOCKER_IPV4_CIDR="172.20.0.0/16"      # Docker IPv4-Netzwerk
DOCKER_IPV6_CIDR="fd00:cafe:beef::/56" # Docker IPv6-Netzwerk

INSTALL_PORTAINER="ja"     # ja=installieren, nein=Ã¼berspringen
INSTALL_WATCHTOWER="ja"    # ja=installieren, nein=Ã¼berspringen

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# E-MAIL-KONFIGURATION (optional aber empfohlen)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ENABLE_SYSTEM_MAIL="ja"    # ja=E-Mail-Benachrichtigungen aktivieren

# SMTP-Server-Einstellungen
SMTP_HOST="smtp.example.com"
SMTP_PORT="587"                         # Standard STARTTLS-Port
SMTP_FROM="server@example.com"

# SMTP-Sicherheit
SMTP_AUTH="ja"            # ja=Authentifizierung erforderlich
SMTP_TLS_STARTTLS="ja"    # ja=STARTTLS verwenden (empfohlen)

# SMTP-Credentials (nur wenn SMTP_AUTH="ja")
SMTP_USER="your-smtp-username"
SMTP_PASSWORD="your-smtp-password"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# OPTIONALE KONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# SSH Public Key (optional, erhÃ¶ht Sicherheit erheblich)
# SSH_PUBLIC_KEY="ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIExample... user@hostname"

# Tailscale Autorisierung (optional, fÃ¼r automatisches VPN-Setup)
# TAILSCALE_AUTH_KEY="tskey-auth-example123..."

# Portainer IP (optional, wird sonst automatisch gewÃ¤hlt)
# PORTAINER_IP="127.0.0.1"  # Lokal, 0.0.0.0=Ã¶ffentlich, Tailscale-IP=VPN

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KONFIGURATIONSBEISPIELE FÃœR VERSCHIEDENE SZENARIEN
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ SZENARIO 1: Deutscher VPS mit maximaler Sicherheit                     â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# ACCESS_MODEL="1"                    # Nur Tailscale-Zugang
# LOCALE="de_DE.UTF-8"               # Deutsche Locale
# HOME_COUNTRY="DE"                  # Deutschland geschÃ¼tzt
# BLOCKED_COUNTRIES="CN RU KP IR BY MM SY AF IQ LY"  # Maximal-Blocking
# ENABLE_GEOIP_BLOCKING="ja"
# ENABLE_SYSTEM_MAIL="ja"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ SZENARIO 2: Ã–ffentlicher US-Server mit Standard-Schutz                 â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# ACCESS_MODEL="2"                    # Ã–ffentlich erreichbar
# LOCALE="en_US.UTF-8"               # US-Locale
# HOME_COUNTRY="US"                  # USA geschÃ¼tzt
# BLOCKED_COUNTRIES="CN RU KP IR"    # Standard-Blocking
# ENABLE_GEOIP_BLOCKING="ja"

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ SZENARIO 3: Schweizer Server ohne GeoIP (minimaler Ansatz)             â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# ACCESS_MODEL="1"                    # Tailscale
# LOCALE="de_CH.UTF-8"               # Schweizer Locale
# ENABLE_GEOIP_BLOCKING="nein"       # Kein GeoIP-Blocking
# ENABLE_SYSTEM_MAIL="nein"         # Keine E-Mails

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ SZENARIO 4: Internationaler Container-Host                             â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# SERVER_ROLE="1"                     # Docker-Host
# ACCESS_MODEL="1"                    # VPN-Zugang
# HOME_COUNTRY="GB"                  # UK geschÃ¼tzt
# BLOCKED_COUNTRIES="CN RU"          # Minimal-Blocking
# INSTALL_PORTAINER="ja"
# INSTALL_WATCHTOWER="ja"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HÃ„UFIGE LÃ„NDER-CODES FÃœR GEOIP-KONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# EuropÃ¤ische LÃ¤nder:
# DE=Deutschland, AT=Ã–sterreich, CH=Schweiz, FR=Frankreich, IT=Italien
# ES=Spanien, NL=Niederlande, BE=Belgien, SE=Schweden, NO=Norwegen
# DK=DÃ¤nemark, FI=Finnland, PL=Polen, CZ=Tschechien, GB=GroÃŸbritannien

# Weitere wichtige LÃ¤nder:
# US=USA, CA=Kanada, AU=Australien, JP=Japan, SG=Singapur, KR=SÃ¼dkorea

# HÃ¤ufige Bedrohungsquellen (fÃ¼r Blocklist):
# CN=China, RU=Russland, KP=Nordkorea, IR=Iran, BY=Belarus
# MM=Myanmar, SY=Syrien, AF=Afghanistan, IQ=Irak, LY=Libyen
# PK=Pakistan, BD=Bangladesch, VN=Vietnam, IN=Indien (mit Vorsicht)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WICHTIGE HINWEISE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ğŸ”’ SICHERHEIT:
# - Verwende starke PasswÃ¶rter (mindestens 12 Zeichen)
# - SSH Public Key ist STARK empfohlen
# - Tailscale (ACCESS_MODEL="1") bietet beste Sicherheit

# ğŸŒ GEOIP-BLOCKING:
# - HOME_COUNTRY wird NIEMALS blockiert (automatischer Schutz)
# - LÃ¶st Konflikte automatisch (entfernt HOME_COUNTRY aus BLOCKED_COUNTRIES)
# - Lokale Netze (192.168.x.x) werden immer erlaubt
# - Reduziert Angriffe um 60-85% je nach Konfiguration

# ğŸ“§ E-MAIL-BENACHRICHTIGUNGEN:
# - Gmail: App-Passwort verwenden (nicht normales Passwort)
# - Outlook: smtp-mail.outlook.com:587
# - Eigener Server: entsprechende SMTP-Daten eintragen

# ğŸ³ DOCKER:
# - Nur bei SERVER_ROLE="1" erforderlich
# - IPv4/IPv6 CIDRs dÃ¼rfen nicht mit vorhandenen Netzen kollidieren
# - Portainer: 127.0.0.1 (sicherster Zugang), 0.0.0.0 (Ã¶ffentlich)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ENDE DER KONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•